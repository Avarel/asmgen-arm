#include <inttypes.h>
#include <stdio.h>

#include "ast.h"

// A function that can be called from assembly to print an integer
void print_int(value_t value) {
    printf("%" PRId64 "\n", value);
    // Clobber all caller-save registers
    asm("movz x0, #0x58C1\n"
        "movk x0, #0x9FA3, lsl #16\n"
        "movk x0, #0x07DE, lsl #32\n"
        "movk x0, #0xB426, lsl #48\n"
        "movz x1, #0x58C1\n"
        "movk x1, #0x9FA3, lsl #16\n"
        "movk x1, #0x07DE, lsl #32\n"
        "movk x1, #0xB426, lsl #48\n"
        "movz x2, #0x58C1\n"
        "movk x2, #0x9FA3, lsl #16\n"
        "movk x2, #0x07DE, lsl #32\n"
        "movk x2, #0xB426, lsl #48\n"
        "movz x3, #0x58C1\n"
        "movk x3, #0x9FA3, lsl #16\n"
        "movk x3, #0x07DE, lsl #32\n"
        "movk x3, #0xB426, lsl #48\n"
        "movz x4, #0x58C1\n"
        "movk x4, #0x9FA3, lsl #16\n"
        "movk x4, #0x07DE, lsl #32\n"
        "movk x4, #0xB426, lsl #48\n"
        "movz x5, #0x58C1\n"
        "movk x5, #0x9FA3, lsl #16\n"
        "movk x5, #0x07DE, lsl #32\n"
        "movk x5, #0xB426, lsl #48\n"
        "movz x6, #0x58C1\n"
        "movk x6, #0x9FA3, lsl #16\n"
        "movk x6, #0x07DE, lsl #32\n"
        "movk x6, #0xB426, lsl #48\n"
        "movz x7, #0x58C1\n"
        "movk x7, #0x9FA3, lsl #16\n"
        "movk x7, #0x07DE, lsl #32\n"
        "movk x7, #0xB426, lsl #48\n"
        "movz x8, #0x58C1\n"
        "movk x8, #0x9FA3, lsl #16\n"
        "movk x8, #0x07DE, lsl #32\n"
        "movk x8, #0xB426, lsl #48\n"
        "movz x9, #0x58C1\n"
        "movk x9, #0x9FA3, lsl #16\n"
        "movk x9, #0x07DE, lsl #32\n"
        "movk x9, #0xB426, lsl #48\n"
        "movz x10, #0x58C1\n"
        "movk x10, #0x9FA3, lsl #16\n"
        "movk x10, #0x07DE, lsl #32\n"
        "movk x10, #0xB426, lsl #48\n"
        "movz x11, #0x58C1\n"
        "movk x11, #0x9FA3, lsl #16\n"
        "movk x11, #0x07DE, lsl #32\n"
        "movk x11, #0xB426, lsl #48\n"
        "movz x12, #0x58C1\n"
        "movk x12, #0x9FA3, lsl #16\n"
        "movk x12, #0x07DE, lsl #32\n"
        "movk x12, #0xB426, lsl #48\n"
        "movz x13, #0x58C1\n"
        "movk x13, #0x9FA3, lsl #16\n"
        "movk x13, #0x07DE, lsl #32\n"
        "movk x13, #0xB426, lsl #48\n"
        "movz x14, #0x58C1\n"
        "movk x14, #0x9FA3, lsl #16\n"
        "movk x14, #0x07DE, lsl #32\n"
        "movk x14, #0xB426, lsl #48\n"
        "movz x15, #0x58C1\n"
        "movk x15, #0x9FA3, lsl #16\n"
        "movk x15, #0x07DE, lsl #32\n"
        "movk x15, #0xB426, lsl #48\n"
        :
        :
        : "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10", "x11", "x12",
          "x13", "x14", "x15");
}
